{% extends "layouts/default.html" %}
{% set title = campaign.title %}
{% set hasChildren = campaign.children.length > 0 %}

{% block outerContent %}
  {{ breadcrumb({
    items: [
      {
        text: "Home",
        href: "/dashboard"
      }
    ],
    text: "School sessions",
    href: "/school-sessions"
  }) }}
{% endblock %}

{% block content %}
  {% if success %}
    {% set html %}
      <p class="govuk-notification-banner__heading">
        New session created
      </p>
    {% endset %}
    {{ govukNotificationBanner({
      html: html,
      type: "success"
    }) }}
  {% endif %}

  <h1 class="nhsuk-heading-l">
    {{ title | noOrphans | safe }}
    <span class="nhsuk-caption-l nhsuk-u-margin-top-2">{{ campaign.date | govukDate() }} at {{ campaign.date | govukTime }}</span>
  </h1>

  {% if not isOffline or campaign["available-offline"] %}
    <div class="nhsuk-grid-row">
      <div class="nhsuk-grid-column-two-thirds">
        <div class="nhsuk-card">
          <div class="nhsuk-card__content">
            {% if not data.features.pilot.on %}
              <h2 class="nhsuk-heading-s nhsuk-u-margin-bottom-3">
                <a href="#">Send consent requests</a>
              </h2>
            {% endif %}

            {% if not hasChildren %}
              <h2 class="nhsuk-heading-s nhsuk-u-margin-bottom-3">
                <a href="#">Add children</a>
              </h2>
              <p>Upload a list of children in this school</p>
            {% endif %}

            {% if hasChildren %}
              <h2 class="nhsuk-heading-s nhsuk-u-margin-bottom-3">
                <a href="/campaign/{{ campaign.id }}/responses">Consent responses</a>
              </h2>

              <h2 class="nhsuk-heading-s nhsuk-u-margin-bottom-3">
                <a href="/campaign/{{ campaign.id }}/triage">Triage</a>
              </h2>

              <h2 class="nhsuk-heading-s nhsuk-u-margin-bottom-3">
                <a href="/campaign/{{ campaign.id }}/record">Record vaccinations</a>
              </h2>
            {% endif %}

            <h2 class="nhsuk-heading-s nhsuk-u-margin-bottom-3">
              <a href="#">Edit session</a>
            </h2>
          </div>
        </div>
      </div>
      <div class="nhsuk-grid-column-one-third">
        {% if hasChildren and not campaign["available-offline"] %}
        <div id="save-offline">
          <h2 class="nhsuk-heading-s">Save offline</h2>
          <p>Record vaccinations while not connected to the internet.</p>

          <form method="post">
            {{ button({
              text: "Save offline",
              classes: "nhsuk-u-margin-bottom-3"
            }) }}
          </form>
        </div>
        {% endif %}

        {% if campaign["available-offline"] %}
          <div id="available-offline">
            <h2 class="nhsuk-heading-s" style="color: #007f3b">
              <span class="app-online-status app-online-status--online">
                {{ appIcon({ type: "tick" }) }} Available offline
              </span>
            </h2>
            {% if campaignOfflineChangesCount == 0 and not campaign.hadOfflineChanges %}
              <p>You can record vaccinations while not connected to the internet.</p>
            {% endif %}
          </div>

          {% if campaignOfflineChangesCount == 1 %}
            <hr class="nhsuk-section-break nhsuk-section-break--visible nhsuk-section-break--m">
            <h2 class="nhsuk-heading-s">You changed 1 record offline</h2>
            <p>Your change will automatically sync when you’re back online.</p>
          {% elif campaignOfflineChangesCount > 1 %}
            <hr class="nhsuk-section-break nhsuk-section-break--visible nhsuk-section-break--m">
            <h2 class="nhsuk-heading-s">You changed {{ campaignOfflineChangesCount }} records offline</h2>
            <p>Your changes will automatically sync when you’re back online.</p>
          {% elif campaign.hadOfflineChanges and campaignOfflineChangesCount == 0 %}
            <hr class="nhsuk-section-break nhsuk-section-break--visible nhsuk-section-break--m">
            <h2 class="nhsuk-heading-s">Your changes were synced</h2>
            <p>They were synced on {{ "today" | govukDate }} at {{ "now" | govukTime }}.</p>
          {% endif %}
        {% endif %}
      </div>
    </div>
  {% else %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      {% set headingHtml %}
        <h2 class="nhsuk-card__heading nhsuk-heading-m">
          <span class="app-online-status app-online-status--offline">
            {{ appIcon({ type: "cross" }) }} Not available offline
          </span>
        </h2>
      {% endset %}

      {{ card({
        headingHtml: headingHtml,
        description: "Go online to access this session"
      }) }}
    </div>
  </div>
  {% endif %}
{% endblock %}
