{% extends "layouts/default.html" %}

{% if filteredYearGroup %}
  {% set caption = "Record vaccinations" %}
  {% set title = filteredYearGroup.name %}
{% else %}
  {% set title = "Record vaccinations" %}
{% endif %}

{% block pageNavigation %}
  {{ breadcrumb({
    items: [
      {
        text: "Home",
        href: "/dashboard"
      },
      {
        text: "Your campaigns",
        href: "/your-campaigns"
      }
    ],
    text: campaign.title,
    href: "/campaign/" + campaign.id
  }) }}
{% endblock %}


{% block main %}
  <div class="nhsuk-width-container">
    <main class="nhsuk-main-wrapper" id="main-content" role="main">
      <div class="nhsuk-grid-row">
        <div class="nhsuk-grid-column-full">
          {% include 'campaign/_children-banner.html' %}

          <h1 class="nhsuk-heading-l">
            {% if caption %}<span class="nhsuk-caption-l">{{ caption }}</span>{% endif %}
            {{ title | noOrphans | safe }}
          </h1>

          {% if campaign['available-offline'] %}
            {% set tagHtml %}
              <span class="nhsuk-u-font-weight-bold nhsuk-u-font-size-16">
                You can record vaccinations for these children while offline
              </span>
            {% endset %}

            <div class="nhsuk-u-margin-bottom-4" style="margin-top: -15px">
            {{ tag({
              html: tagHtml,
              classes: 'nhsuk-tag--blue'
            }) }}
            </div>
          {% endif %}

          {% set listOfPeople %}
          <div class="nhsuk-grid-row">
            <!-- <div class="nhsuk-grid-column-one-quarter">
              <p class="nhsuk-u-margin-bottom-1">By year group:</p>
              <ul class="nhsuk-list">
                {% for group in campaign.yearGroups %}
                  <li>
                    {% if filteredYearGroup.number == group.number %}
                      <a class="app-u-inherit app-u-text-decoration-none nhsuk-u-font-weight-bold" href="?year={{ group.number }}">
                        {{ group.name }}
                      </a>
                    {% else %}
                      <a href="?year={{ group.number }}">
                        {{ group.name }}
                      </a>
                    {% endif %}
                  </li>
                {% endfor %}
              </ul>

              <p class="nhsuk-u-margin-bottom-1">By status:</p>
              <ul class="nhsuk-list">
                <li>
                  <a href="#">Seen</a>
                </li>
                <li>
                  <a href="#">Not seen</a>
                </li>
              </ul>

              <p class="nhsuk-u-margin-bottom-1">By consent:</p>
              <ul class="nhsuk-list">
                <li>
                  <a href="#">Consent given</a>
                </li>
                <li>
                  <a href="#">Consent refused</a>
                </li>
                <li>
                  <a href="#">No response</a>
                </li>
              </ul>
            </div> -->
            <div class="nhsuk-grid-column-full">
              <div class="govuk-grid-row">
                <div class="govuk-grid-column-one-half">
                  <div class="">
                    {{ input({
                      label: {
                        text: 'Search by name'
                      },
                      decorate: 'search'
                    }) }}
                  </div>
                </div>
              </div>
              <table class="nhsuk-table" id="children">
                <thead class="govuk-table__head">
                  <tr class="govuk-table__row">
                    <th class="govuk-table__header">Name</th>
                    <th class="govuk-table__header">Date of birth</th>
                    <!-- <th class="govuk-table__header">Consent</th> -->
                    <th class="govuk-table__header">Outcome</th>
                  </tr>
                </thead>
                <tbody class="govuk-table__body">
                  {% for child in (filteredChildren or campaign.children) %}
                    <tr class="govuk-table__row">
                      <td class="govuk-table__cell">
                        <a href="/campaign/{{ campaign.id }}/child/{{ child.nhsNumber }}">{{ child.fullName }}</a>
                        {% if child.preferredName %}
                          <br />Known as: {{ child.preferredName }}
                        {% endif %}
                      </td>
                      <td class="govuk-table__cell" style="width: 150px">
                        {{ child.dob | govukDate('truncate') }}
                      </td>
                      <!-- <td class="govuk-table__cell" style="width: 150px">
                        {% set consent = ['Given', 'Refused', 'No response'] | random %}
                        {% if consent == 'Given' %}
                          <span class="nhsuk-tag nhsuk-tag--green" style="width: 100%">
                            <svg class="nhsuk-icon nhsuk-icon__tick app-icon-small" style="vertical-align: top" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" aria-hidden="true" width="17" height="17">
                              <path stroke-width="4" stroke-linecap="round" d="M18.4 7.8l-8.5 8.4L5.6 12" stroke="{{ color }}"></path>
                            </svg>
                            <span class="nhsuk-u-font-weight-bold nhsuk-u-font-size-16">
                              Given
                            </span>
                          </span>
                        {% elseif consent == 'Refused' %}
                          <span class="nhsuk-tag nhsuk-tag--red" style="width: 100%">
                            <svg class="nhsuk-icon nhsuk-icon__cross app-icon-small" style="vertical-align: bottom" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" width="34" height="34">
                              <path d="M17 18.5c-.4 0-.8-.1-1.1-.4l-10-10c-.6-.6-.6-1.6 0-2.1.6-.6 1.5-.6 2.1 0l10 10c.6.6.6 1.5 0 2.1-.3.3-.6.4-1 .4z" fill="#6b140e"></path>
                              <path d="M7 18.5c-.4 0-.8-.1-1.1-.4-.6-.6-.6-1.5 0-2.1l10-10c.6-.6 1.5-.6 2.1 0 .6.6.6 1.5 0 2.1l-10 10c-.3.3-.6.4-1 .4z" fill="#6b140e"></path>
                            </svg>
                            <span class="nhsuk-u-font-weight-bold nhsuk-u-font-size-16">
                              Refused
                            </span>
                          </span>
                        {% elseif consent == 'No response' %}
                          <span class="nhsuk-tag nhsuk-tag--grey" style="width: 100%">
                            <span class="nhsuk-u-font-weight-bold nhsuk-u-font-size-16">
                              No response
                            </span>
                          </span>
                        {% endif %}
                      </td> -->
                      <td class="govuk-table__cell">
                        {% set outcomes = [
                          'Seen and vaccinated',
                          'Seen but not vaccinated',
                          'Not yet seen, consent given',
                          'Not yet seen, consent refused',
                          'Not yet seen, no consent response'
                          ] %}
                        {% set outcome = outcomes | random %}

                        {% if outcome == 'Seen and vaccinated' or outcome == 'Seen but not vaccinated' %}
                          <span class="nhsuk-tag nhsuk-tag--green">
                            <span class="nhsuk-u-font-weight-bold nhsuk-u-font-size-16">
                              <span class="nhsuk-icon nhsuk-icon__tick app-icon-small"></span>
                              {{ outcome }}
                            </span>
                          </span>
                        {% else %}
                          <!-- <span class="nhsuk-tag nhsuk-tag--grey">
                            <span class="nhsuk-u-font-weight-bold nhsuk-u-font-size-16">
                              <span class="nhsuk-icon nhsuk-icon__tick app-icon-small"></span>

                            </span>
                          </span> -->
                          {{ outcome }}
                        {% endif %}

                        {% if child.seen.text != 'Not yet' %}
                          {% set isOfflineSaved = child.seen.isOffline %}
                          {% set color = "#004281" if isOfflineSaved else '#007f3b' %}
                          {% set tagHtml %}
                            <svg class="nhsuk-icon nhsuk-icon__tick app-icon-small" style="vertical-align: top" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" aria-hidden="true" width="17" height="17">
                              <path stroke-width="4" stroke-linecap="round" d="M18.4 7.8l-8.5 8.4L5.6 12" stroke="{{ color }}"></path>
                            </svg>
                            <span class="nhsuk-u-font-weight-bold nhsuk-u-font-size-16">
                              Saved {{ 'offline' if isOfflineSaved }}
                            </span>
                          {% endset %}

                          {{ tag({
                            html: tagHtml,
                            classes: 'nhsuk-tag--blue' if child.seen.isOffline else 'nhsuk-tag--green'
                          }) }}
                        {% endif %}
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          {% endset %}

          {{ card({
            "heading": "Children",
            "headingLevel": "2",
            "headingClasses": "nhsuk-heading-m",
            "description": listOfPeople,
            "classes": "nhsuk-u-margin-bottom-0"
          }) }}
        </div>
      </div>
    </main>
  </div>

  <script>
    function filterTable() {
      var inputValue = document.getElementById("search").value.toLowerCase();
      var rows = document.getElementById("children").querySelectorAll("tbody tr");

      for (var i = 0; i < rows.length; i++) {
        var nameCell = rows[i].getElementsByTagName("td")[0];
        var name = nameCell.textContent || nameCell.innerText;
        if (name.toLowerCase().indexOf(inputValue) > -1) {
          rows[i].style.display = "";
        } else {
          rows[i].style.display = "none";
        }
      }
    }
    document.getElementById("search").addEventListener("input", filterTable);
  </script>
{% endblock %}
