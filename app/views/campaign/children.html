{% extends "layouts/default.html" %}

{% if filteredYearGroup %}
  {% set caption = "Record vaccinations" %}
  {% set title = filteredYearGroup.name %}
{% else %}
  {% set title = "Record vaccinations" %}
{% endif %}

{% block pageNavigation %}
  {{ breadcrumb({
    items: [
      {
        text: "Home",
        href: "/dashboard"
      },
      {
        text: "Your campaigns",
        href: "/your-campaigns"
      }
    ],
    text: campaign.title,
    href: "/campaign/" + campaign.id
  }) }}
{% endblock %}

{% block main %}
  <div class="nhsuk-width-container">
    <main class="nhsuk-main-wrapper" id="main-content" role="main">
      <div class="nhsuk-grid-row">
        <div class="nhsuk-grid-column-full">
          {% include 'campaign/_children-banner.html' %}

          <h1 class="nhsuk-heading-l">
            {% if caption %}<span class="nhsuk-caption-l">{{ caption }}</span>{% endif %}
            {{ title | noOrphans | safe }}
          </h1>

          {% if campaign['available-offline'] %}
            {% set tagHtml %}
              <span class="nhsuk-u-font-weight-bold nhsuk-u-font-size-16">
                You can record vaccinations for these children while offline
              </span>
            {% endset %}

            <div class="nhsuk-u-margin-bottom-4" style="margin-top: -15px">
            {{ tag({
              html: tagHtml,
              classes: 'nhsuk-tag--blue'
            }) }}
            </div>
          {% endif %}

          {% set listOfPeople %}
          <div class="nhsuk-grid-row">
            <div class="nhsuk-grid-column-one-quarter">
              <p class="nhsuk-u-margin-bottom-1">By year group:</p>
              <ul class="nhsuk-list">
                {% for group in campaign.yearGroups %}
                  <li>
                    {% if filteredYearGroup.number == group.number %}
                      <a class="app-u-inherit app-u-text-decoration-none nhsuk-u-font-weight-bold" href="?year={{ group.number }}">
                        {{ group.name }}
                      </a>
                    {% else %}
                      <a href="?year={{ group.number }}">
                        {{ group.name }}
                      </a>
                    {% endif %}
                  </li>
                {% endfor %}
              </ul>

              <p class="nhsuk-u-margin-bottom-1">By outcome:</p>
              <ul class="nhsuk-list">
                <li>
                  <a href="#">No outcome yet</a>
                </li>
                <li>
                  <a href="#">Vaccinated</a>
                </li>
                <li>
                  <a href="#">Not vaccinated</a>
                </li>
                <li>
                  <a href="#">Could not vaccinate</a>
                </li>
              </ul>

              <p class="nhsuk-u-margin-bottom-1">By consent:</p>
              <ul class="nhsuk-list">
                <li>
                  <a href="#">Given</a>
                </li>
                <li>
                  <a href="#">Refused</a>
                </li>
                <li>
                  <a href="#">Unknown</a>
                </li>
              </ul>
            </div>
            <div class="nhsuk-grid-column-three-quarters">
              <div class="govuk-grid-row">
                <div class="govuk-grid-column-one-half">
                  <div class="">
                    {{ input({
                      label: {
                        text: 'Search by name'
                      },
                      decorate: 'search'
                    }) }}
                  </div>
                </div>
              </div>
              <table class="nhsuk-table app-children-table" id="children">
                <thead class="govuk-table__head">
                  <tr class="govuk-table__row">
                    <th class="govuk-table__header">Name</th>
                    <th class="govuk-table__header">Date of birth</th>
                    <th class="govuk-table__header">Consent</th>
                    <th class="govuk-table__header" style="width: 200px">Outcome</th>
                  </tr>
                </thead>
                <tbody class="govuk-table__body">
                  {% for child in (filteredChildren or campaign.children) %}
                    <tr class="govuk-table__row">
                      <td class="govuk-table__cell">
                        <a href="/campaign/{{ campaign.id }}/child/{{ child.nhsNumber }}">{{ child.fullName }}</a>
                        {% if child.preferredName %}
                          <br />Known as: {{ child.preferredName }}
                        {% endif %}
                      </td>
                      <td class="govuk-table__cell" style="width: 150px">
                        {{ child.dob | govukDate('truncate') }}
                      </td>
                      <td class="govuk-table__cell">
                        {% set consentText = child.consent.text if campaign.is3in1MenACWY else child.consent[campaign.type] %}
                        {{ consentText }}
                      </td>
                      <td class="govuk-table__cell">
                        {{ appOutcomeTag(child.outcome) }}
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          {% endset %}

          {{ card({
            "heading": "Children",
            "headingLevel": "2",
            "headingClasses": "nhsuk-heading-m",
            "description": listOfPeople,
            "classes": "nhsuk-u-margin-bottom-0"
          }) }}
        </div>
      </div>
    </main>
  </div>

  <script>
    function filterTable() {
      var inputValue = document.getElementById("search").value.toLowerCase();
      var rows = document.getElementById("children").querySelectorAll("tbody tr");

      for (var i = 0; i < rows.length; i++) {
        var nameCell = rows[i].getElementsByTagName("td")[0];
        var name = nameCell.textContent || nameCell.innerText;
        if (name.toLowerCase().indexOf(inputValue) > -1) {
          rows[i].style.display = "";
        } else {
          rows[i].style.display = "none";
        }
      }
    }
    document.getElementById("search").addEventListener("input", filterTable);
  </script>
{% endblock %}
