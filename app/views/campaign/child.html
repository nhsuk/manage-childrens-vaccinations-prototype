{% extends "layouts/default.html" %}

{% set title = child.fullName %}
{% set vaccineGiven = vaccination.outcome == VACCINATION_OUTCOME.VACCINATED %}
{% set hasNoResponse = child.consent.outcome == CONSENT_OUTCOME.NO_RESPONSE %}
{% set hasRefused = child.consent.outcome == CONSENT_OUTCOME.REFUSED %}
{% set hasConsented = not hasRefused and not hasNoResponse %}

{% block outerContent %}
  {{ backLink({
    href: "/campaign/" + campaign.id + "/record",
    classes: "nhsuk-u-margin-top-4 nhsuk-u-margin-bottom-0"
  }) }}
{% endblock %}

{% block content %}
  {{ appHeading({ title: title }) }}

  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-two-thirds">
      {% if child.triage.outcome == TRIAGE_OUTCOME.NEEDS_TRIAGE %}
        {% include "campaign/child/_triage-banner.html" %}
      {% elif child.outcome == PATIENT_OUTCOME.NO_OUTCOME_YET %}
        {% include "campaign/child/_consent-banner.html" %}
      {% else %}
        {% include "campaign/child/_outcome-banner.html" %}
      {% endif %}

      {% include "campaign/child/_details.html" %}

      {% include "campaign/child/_responses.html" %}
      {% include "campaign/child/_consent-gillick.html" %}

      {% if hasConsented %}
        {% include "campaign/child/_triage.html" %}
      {% endif %}

      {% if child.outcome == PATIENT_OUTCOME.NO_OUTCOME_YET %}
        {% if hasNoResponse or hasRefused %}
          {% include "campaign/child/_action-get-consent.html" %}
        {% elif child.triage.outcome == TRIAGE_OUTCOME.NEEDS_TRIAGE %}
          {% include "campaign/child/_action-triage.html" %}
        {% elif child.triage.outcome == TRIAGE_OUTCOME.VACCINATE or
          child.triage.outcome == TRIAGE_OUTCOME.NONE %}
          {% include "campaign/child/_action-vaccinate.html" %}
        {% endif %}
      {% elif child.outcome == PATIENT_OUTCOME.VACCINATED %}
        {% include "campaign/child/_vaccination-recorded.html" %}
      {% endif %}
    </div>

    <div class="nhsuk-grid-column-one-third">
      {% if campaign["available-offline"] %}
        <div id="available-offline">
          <h2 class="nhsuk-heading-s nhsuk-u-margin-top-5">
            <span class="app-online-status app-online-status--online">
              {{ appIcon({ type: "tick" }) }} Available offline
            </span>
          </h2>
          {% if not child.seen.isOffline and not child.hadOfflineChanges %}
            <p>You can make changes to this child’s record while not connected to the internet.</p>
          {% endif %}
        </div>

        {% if child.seen.isOffline %}
          <hr>
          <h2 class="nhsuk-heading-s">You made changes offline</h2>
          <p>Your changes will automatically sync when you’re back online.</p>
        {% endif %}

        {% if child.hadOfflineChanges and not child.seen.isOffline %}
          <hr>
          <h2 class="nhsuk-heading-s">Your changes were synced</h2>
          <p>They were synced on {{ "today" | govukDate }} at {{ "now" | govukTime }}.</p>
          <p><a href="#">Hide this message</a></p>
        {% endif %}
      {% endif %}
    </div>
  </div>
{% endblock %}
