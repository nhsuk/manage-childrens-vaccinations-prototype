{% extends "layouts/default.html" %}

{% if filteredYearGroup %}
  {% set caption = "Triage" %}
  {% set title = filteredYearGroup.name %}
{% else %}
  {% set title = "Triage" %}
{% endif %}

{% block outerContent %}
  {{ breadcrumb({
    items: [
      {
        text: "Home",
        href: "/dashboard"
      },
      {
        text: "School sessions",
        href: "/school-sessions"
      }
    ],
    text: campaign.title,
    href: "/campaign/" + campaign.id
  }) }}
{% endblock %}

{% block content %}
  {% include "campaign/_notification-banner.html" %}

  {% if campaign["available-offline"] %}
    <span class="nhsuk-heading-s nhsuk-u-margin-bottom-1" style="color: #007f3b">Available offline</span>
  {% endif %}

  <h1 class="nhsuk-heading-xl nhsuk-u-margin-bottom-6">
    {% if caption %}<span class="nhsuk-caption-l">{{ caption }}</span>{% endif %}
    {{ title | noOrphans | safe }}
  </h1>

  {% set triageNeeded %}
    {% set tab = filters.triageNeeded %}
    {% include "campaign/_tab.html" %}
  {% endset %}

  {% set triageCompleted %}
    {% set tab = filters.triageCompleted %}
    {% include "campaign/_tab.html" %}
  {% endset %}

  {% set noTriageNeeded %}
    {% set tab = filters.noTriageNeeded %}
    {% include "campaign/_tab.html" %}
  {% endset %}

  {{ tabs({
    items: [
      {
        id: "needs-triage",
        label: filters.triageNeeded.label,
        panel: { html: triageNeeded }
      },
      {
        id: "triage-completed",
        label: filters.triageCompleted.label,
        panel: { html: triageCompleted }
      },
      {
        id: "no-triage-needed",
        label: filters.noTriageNeeded.label,
        panel: { html: noTriageNeeded }
      }
    ]
  }) }}

  <script>
    function filterTable() {
      var inputValue = document.getElementById("search").value.toLowerCase();
      var rows = document.getElementById("children").querySelectorAll("tbody tr");

      for (var i = 0; i < rows.length; i++) {
        var nameCell = rows[i].getElementsByTagName("td")[0];
        var name = nameCell.textContent || nameCell.innerText;
        if (name.toLowerCase().indexOf(inputValue) > -1) {
          rows[i].style.display = "";
        } else {
          rows[i].style.display = "none";
        }
      }
    }
    document.getElementById("search").addEventListener("input", filterTable);
  </script>
{% endblock %}
