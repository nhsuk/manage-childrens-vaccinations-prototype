{% extends "_layouts/default.html" %}

{% set title = "Triage health questions" %}
{% set section = "triage" %}

{% block beforeContent %}
  {{ breadcrumbs({
    items: [
      {
        attributes: {
          class: "nhsuk-breadcrumb__item"
        },
        text: "Home",
        href: "/dashboard"
      },
      {
        text: "School sessions",
        href: "/sessions"
      },
      {
        text: session.title,
        href: "/sessions/" + session.id
      },
      {
        text: title
      }
    ]
  }) }}
{% endblock %}

{% block content %}
  {% include "sessions/_notification-banner.html" %}

  {% if session["available-offline"] %}
    <span class="app-status app-status--green">
      {{ icon("tick") }} Available offline
    </span>
  {% endif %}

  {{ heading({
    title: filteredYearGroup.name if filteredYearGroup else title,
    caption: title if filteredYearGroup
  }) }}

  {% set triageNeeded %}
    {% set tab = filters.triageNeeded %}
    {% include "sessions/_tab.html" %}
  {% endset %}

  {% set triageCompleted %}
    {% set tab = filters.triageCompleted %}
    {% include "sessions/_tab.html" %}
  {% endset %}

  {% set noTriageNeeded %}
    {% set tab = filters.noTriageNeeded %}
    {% include "sessions/_tab.html" %}
  {% endset %}

  {{ tabs({
    items: [
      {
        id: "needs-triage",
        label: filters.triageNeeded.label,
        panel: { html: triageNeeded }
      },
      {
        id: "triage-completed",
        label: filters.triageCompleted.label,
        panel: { html: triageCompleted }
      },
      {
        id: "no-triage-needed",
        label: filters.noTriageNeeded.label,
        panel: { html: noTriageNeeded }
      }
    ]
  }) }}
{% endblock %}

{% block bodyEnd %}
<script>
  function filterTable() {
    var inputValue = document.getElementById("search").value.toLowerCase();
    var rows = document.getElementById("patients").querySelectorAll("tbody tr");

    for (var i = 0; i < rows.length; i++) {
      var nameCell = rows[i].getElementsByTagName("td")[0];
      var name = nameCell.textContent || nameCell.innerText;
      if (name.toLowerCase().indexOf(inputValue) > -1) {
        rows[i].style.display = "";
      } else {
        rows[i].style.display = "none";
      }
    }
  }
  document.getElementById("search").addEventListener("input", filterTable);
</script>
{% endblock %}
