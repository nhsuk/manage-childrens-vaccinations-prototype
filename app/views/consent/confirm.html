{% extends "layouts/wizard.html" %}
{% set title = "Check and confirm answers" %}
{% set buttonText = "Confirm" %}
{% set hasConsented = d(base + "consent") == CONSENT_OUTCOME.VALID %}
{% set hasRefused = d(base + "consent") == CONSENT_OUTCOME.REFUSED %}
{% set isGillickCompetent = d(base + "gillick-competent") === "Yes" %}

{% block form %}
  <h1 class="nhsuk-heading-l">{{ title }}</h1>

  {% set parentContactDetailsHtml %}
    <div class="nhsuk-u-margin-top-2 nhsuk-u-font-size-16">
      {{ d(base + "parent.name") }}<br>
      Phone: {{ d(base + "parent.tel") }}
    </div>
  {% endset %}

  {% if isGillickCompetent %}
    {% set consentRecord = d("consent." + campaign.id + "." + child.nhsNumber) %}
    {% include "campaign/child/_consent-gillick.html" %}
  {% else %}
    {{ card({
      heading: "Consent",
      headingLevel: "2",
      headingClasses: "nhsuk-heading-m",
      descriptionHtml: govukSummaryList({
        classes: "app-summary-list--no-bottom-border",
        rows: decorateRows([
          {
            key: "Consent",
            value: d(base + "consent"),
            href: "#"
          } if hasConsented or hasRefused,
          {
            key: "Consent",
            value: "No response",
            href: "#"
          } if not (hasConsented or hasRefused),
          {
            key: "For",
            value: child.fullName
          },
          {
            key: "By",
            value: {
              html: d(base + "parent.relationship") + parentContactDetailsHtml
            },
            href: "#"
          },
          {
            key: "Reason",
            value: {
              html: d(base + "refusalReason") + (" â€“ " + d(base + "refusalReasonOther") if d(base + "refusalReason") == "Other")
            },
            href: "#"
          } if hasRefused
        ])
      })
    }) }}
  {% endif %}

  {% if hasConsented %}
    {% set consentJourney = true %}
    {% include "campaign/child/_health-answers.html" %}

    <div class="nhsuk-card">
      <div class="nhsuk-card__content">
        <h2 class="nhsuk-heading-m">Triage</h2>
        {{ govukSummaryList({
          classes: "app-summary-list--no-bottom-border",
          rows: decorateRows([
            {
              key: "Status",
              value: d("triage." + campaign.id + "." + child.nhsNumber + ".outcome") or "Not provided",
              href: "#"
            },
            {
              key: "Triage notes",
              value: d("triage." + campaign.id + "." + child.nhsNumber + ".note") or "Not provided",
              href: "#"
            }
          ])
        }) }}
      </div>
    </div>
  {% endif %}
{% endblock %}
