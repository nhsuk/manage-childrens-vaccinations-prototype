{% extends "_layouts/wizard.html" %}

{% set title = "Check and confirm answers" %}
{% set buttonText = "Confirm" %}
{% set hasConsented = d(base + "consent") == CONSENT_OUTCOME.VALID %}
{% set hasRefused = d(base + "consent") == CONSENT_OUTCOME.REFUSED %}
{% set isGillickCompetent = d(base + "gillickCompetent") === "Yes" %}

{% block form %}
  {{ heading({ title: title }) }}

  {% set parentContactDetailsHtml %}
    <div class="nhsuk-u-margin-top-2 nhsuk-u-font-size-16">
      {{ d(base + "parent.name") }}<br>
      Phone: {{ d(base + "parent.tel") }}
    </div>
  {% endset %}

  {% if isGillickCompetent %}
    {% set consentRecord = d("consent." + campaign.id + "." + patient.nhsNumber) %}
    {% include "campaign/patient/_gillick-competence.html" %}
  {% else %}
    {{ card({
      heading: "Consent",
      headingClasses: "nhsuk-heading-m",
      descriptionHtml: summaryList({
        rows: decorateRows([
          {
            key: "Consent",
            value: d(base + "consent"),
            href: "#"
          } if hasConsented or hasRefused,
          {
            key: "Consent",
            value: "No response",
            href: "#"
          } if not (hasConsented or hasRefused),
          {
            key: "For",
            value: patient.fullName
          },
          {
            key: "By",
            value: {
              html: d(base + "parent.relationship") + parentContactDetailsHtml
            },
            href: "#"
          },
          {
            key: "Reason",
            value: {
              html: d(base + "refusalReason") + (" â€“ " + d(base + "refusalReasonOther") if d(base + "refusalReason") == "Other")
            },
            href: "#"
          } if hasRefused
        ])
      })
    }) }}
  {% endif %}

  {% if hasConsented %}
    {% set description %}
      <p><a href="#">Change</a></p>

      {{ summaryList({
        classes: "app-summary-list--full-width",
        rows: healthAnswerRows(campaign, patient.responses)
      }) }}
    {% endset %}

    {{ card({
      heading: "Health questions",
      headingClasses: "nhsuk-heading-m",
      description: description
    }) }}

    {{ card({
      heading: "Triage",
      headingClasses: "nhsuk-heading-m",
      description: summaryList({
        rows: decorateRows([
          {
            key: "Status",
            value: d("triage." + campaign.id + "." + patient.nhsNumber + ".outcome") or "Not provided",
            href: "#"
          },
          {
            key: "Triage notes",
            value: d("triage." + campaign.id + "." + patient.nhsNumber + ".note") or "Not provided",
            href: "#"
          }
        ])
      })
    }) }}
  {% endif %}
{% endblock %}
